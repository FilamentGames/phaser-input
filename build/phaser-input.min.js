/*!
 * phaser-input - version 1.2.3-filament5 
 * Adds input boxes to Phaser like CanvasInput, but also works for WebGL and Mobile, made for Phaser only.
 *
 * OrangeGames
 * Build at 25-08-2016
 * Released under MIT License 
 */

var Fabrique;!function(a){!function(a){a[a.text=0]="text",a[a.password=1]="password",a[a.number=2]="number"}(a.InputType||(a.InputType={}));var b=a.InputType,c=function(){function c(b,c,d,e){var f=this;void 0===d&&(d=""),this.focusIn=new Phaser.Signal,this.focusOut=new Phaser.Signal,this.id=c,this.type=e.type,this.game=b,e.wordWrap?this.element=document.createElement("textarea"):(this.element=document.createElement("input"),this.element.type=a.InputType[this.type]),this.setMax(e.max,e.min),this.element.id=c,this.element.style.position="absolute",this.element.style.top=(-1e3).toString()+"px",this.element.style.left=(-1e3).toString()+"px",this.element.style.width=e.width+"px",this.element.style.height=e.height+"px",this.element.style.font=e.font,this.element.style.textAlign=e.align,this.element.style.fontWeight=e.fontWeight.toString(),this.element.value=this.value,this.element.addEventListener("focusin",function(){f.focusIn.dispatch()}),this.element.addEventListener("focusout",function(){f.focusOut.dispatch()}),document.body.appendChild(this.element)}return c.prototype.addEventListeners=function(a,b,c){this.inputCallback=a,this.keyDownCallback=b,this.keyUpCallback=c,this.element.addEventListener("input",this.inputCallback),this.element.addEventListener("keydown",this.keyDownCallback),this.element.addEventListener("keyup",this.keyUpCallback)},c.prototype.removeEventListeners=function(){this.element.removeEventListener("input",this.inputCallback),this.element.removeEventListener("keydown",this.keyDownCallback),this.element.removeEventListener("keyup",this.keyUpCallback)},c.prototype.destroy=function(){document.body.removeChild(this.element)},c.prototype.setMax=function(a,c){if(void 0!==a)if(this.type===b.text||this.type===b.password)this.element.maxLength=parseInt(a,10);else if(this.type===b.number){if(this.element.max=a,void 0===c)return;this.element.min=c}},Object.defineProperty(c.prototype,"value",{get:function(){return this.element.value},set:function(a){this.element.value=a},enumerable:!0,configurable:!0}),c.prototype.focus=function(){var a=this;if(this.element.focus(),!this.game.device.desktop&&this.game.device.chrome)var b=window.innerWidth,c=window.innerHeight,d=!1,e=setInterval(function(){(b>window.innerWidth||c>window.innerHeight)&&(d=!0),d&&b===window.innerWidth&&c===window.innerHeight&&(a.focusOut.dispatch(),clearInterval(e))},50)},c.prototype.blur=function(){this.element.blur()},Object.defineProperty(c.prototype,"hasSelection",{get:function(){return this.type!==b.number&&this.element.selectionStart!==this.element.selectionEnd},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"caretStart",{get:function(){return this.element.selectionEnd},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"caretEnd",{get:function(){return this.element.selectionStart},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"caretPosition",{get:function(){return this.type===b.number?-1:this.element.selectionStart},set:function(a){this.type!==b.number&&this.element.setSelectionRange(a,a)},enumerable:!0,configurable:!0}),c}();a.InputElement=c}(Fabrique||(Fabrique={}));var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},Fabrique;!function(a){var b=function(b){function c(c,d,e,f){var g=this;void 0===f&&(f={}),b.call(this,c,d,e),this.placeHolder=null,this.box=null,this.focus=!1,this.windowScale=1,this.scrollPos=new Phaser.Point,this.cursorPos=new Phaser.Point,this.blink=!0,this.cnt=0,this.inputOptions=f,this.inputOptions.width=f.width||150,this.inputOptions.padding=f.padding||0,this.inputOptions.align=f.align||"left",this.inputOptions.type=f.type||a.InputType.text,this.inputOptions.borderRadius=f.borderRadius||0,this.inputOptions.height=f.height||14,this.inputOptions.fillAlpha=void 0===f.fillAlpha?1:f.fillAlpha,this.inputOptions.selectionColor=f.selectionColor||"rgba(179, 212, 253, 0.8)",this.inputOptions.zoom=!c.device.desktop&&(f.zoom||!1),this.inputOptions.font=f.font||"14px Arial",this.inputOptions.fontWeight=f.fontWeight||"normal",this.inputOptions.fill=f.fill||"#000000",this.inputOptions.placeHolderColor=f.placeHolderColor||"#bfbebd",this.box=new a.InputBox(this.game,f),this.setTexture(this.box.generateTexture()),this.textMask=new a.TextMask(this.game,f),this.addChild(this.textMask),this.domElement=new a.InputElement(this.game,"phaser-input-"+(1e4*Math.random()|0).toString(),"",this.inputOptions),f.placeHolder&&f.placeHolder.length>0&&(this.placeHolder=new Phaser.Text(c,this.inputOptions.padding,this.inputOptions.padding,f.placeHolder,{font:f.font,fontWeight:f.fontWeight,fill:f.placeHolderColor,wordWrap:f.wordWrap,wordWrapWidth:f.width}),this.placeHolder.mask=this.textMask,this.placeHolder.useAdvancedWrap=!0,this.addChild(this.placeHolder)),this.cursor=new Phaser.Text(c,this.inputOptions.padding,this.inputOptions.padding-2,"|",{font:f.font,fontWeight:f.fontWeight,fill:f.cursorColor}),this.cursor.visible=!1,this.addChild(this.cursor),this.text=new Phaser.Text(c,this.inputOptions.padding,this.inputOptions.padding,"",{font:f.font,fontWeight:f.fontWeight,fill:f.fill,wordWrap:f.wordWrap,wordWrapWidth:f.width}),this.text.mask=this.textMask,this.text.useAdvancedWrap=!0,this.addChild(this.text),this.offscreenText=new Phaser.Text(c,this.inputOptions.padding,this.inputOptions.padding,"",{font:f.font,fontWeight:f.fontWeight,fill:f.fill,wordWrapWidth:f.width}),this.offscreenText.useAdvancedWrap=!0,this.selection=new a.SelectionHighlight(this.game,this.inputOptions,this.offscreenText,this.cursor),this.addChild(this.selection),this.updateTextPos(),this.inputEnabled=!0,this.input.useHandCursor=!0,this.game.input.onDown.add(this.checkDown,this),this.domElement.focusOut.add(function(){a.Plugins.InputField.KeyboardOpen&&g.endFocus()})}return __extends(c,b),Object.defineProperty(c.prototype,"value",{get:function(){return this.domElement.value},set:function(a){this.domElement.value=a,this.updateFromDomElement()},enumerable:!0,configurable:!0}),c.prototype.checkDown=function(a){this.value||this.resetText(),this.input.checkPointerOver(a)?this.startFocus(a):this.focus===!0&&this.endFocus()},c.prototype.update=function(){this.focus&&(this.updateFromDomElement(),this.updateCursorBlink())},c.prototype.updateCursorBlink=function(){return 30!==this.cnt?this.cnt++:(this.cursor.visible=this.blink,this.blink=!this.blink,void(this.cnt=0))},c.prototype.endFocus=function(){var b=this;this.domElement.removeEventListeners(),this.focus=!1,0===this.value.length&&null!==this.placeHolder&&(this.placeHolder.visible=!0),this.cursor.visible=!1,this.game.device.desktop?setTimeout(function(){b.domElement.blur()},0):this.domElement.blur(),this.game.device.desktop||(a.Plugins.InputField.KeyboardOpen=!1,a.Plugins.InputField.onKeyboardClose.dispatch()),this.inputOptions.zoom&&this.zoomOut()},c.prototype.startFocus=function(a){var b=this;this.game.device.desktop?setTimeout(function(){b.finishFocus(a)},0):this.finishFocus(a)},c.prototype.finishFocus=function(b){this.focus=!0,null!==this.placeHolder&&(this.placeHolder.visible=!1),this.domElement.addEventListeners(this.inputListener.bind(this),this.keyDownListener.bind(this),this.keyUpListener.bind(this)),this.domElement.focus(),this.updateFromDomElement(),this.domElement.caretPosition=this.getCursorIndex(new PIXI.Point(b.x,b.y)),this.game.device.desktop||(a.Plugins.InputField.KeyboardOpen=!0,a.Plugins.InputField.onKeyboardOpen.dispatch()),this.inputOptions.zoom&&!a.Plugins.InputField.Zoomed&&this.zoomIn()},c.prototype.updateTextFromElement=function(){null!==this.placeHolder&&(this.value.length>0?this.placeHolder.visible=!1:this.placeHolder.visible=!0),this.text.setText(this.value),this.inputOptions.wordWrap?this.lines=this.offscreenText.precalculateWordWrap(this.value):this.lines=[this.value]},c.prototype.updateCursorFromElement=function(){this.cursorPos=this.getCaretPosition(),this.scrollTo(this.cursorPos),this.updateCursorPos()},c.prototype.getCaretPosition=function(){var b=this.domElement.caretPosition;-1===b&&(b=this.value.length);var c=this.value;if(this.inputOptions.type===a.InputType.password){c="";for(var d=0;d<this.value.length;d++)c+="*"}if(!this.inputOptions.wordWrap){this.text.context.font=this.text.cssFont;var e=this.text.context.measureText(c.slice(0,b)).width;return new Phaser.Point(e,0)}for(var f=this.lines,g=0,h=0;h<f.length;h++){var i=f[h];if(g+i.length>=b){var j=b-g;i=i.slice(0,j),this.text.context.font=this.text.cssFont;var e=this.text.context.measureText(i).width;return new Phaser.Point(e,this.cursor.height*h)}if(h==f.length-1){this.text.context.font=this.text.cssFont;var e=this.text.context.measureText(i).width;return new Phaser.Point(e,this.cursor.height*h)}g+=i.length+1}},c.prototype.updateFromDomElement=function(){this.updateTextFromElement(),this.updateCursorFromElement(),this.updateSelection()},c.prototype.getCursorIndex=function(a){var b=this.text.toLocal(new PIXI.Point(a.x,a.y),this.game.world);this.inputOptions.align&&"center"===this.inputOptions.align&&(b.x+=this.text.width/2);var c=0;if(this.inputOptions.wordWrap)for(var d=this.text.precalculateWordWrap(this.value),e=0,f=this.cursor.height;e<d.length;e++,f+=this.cursor.height){for(var g=d[e],h=0;h<g.length;h++,c++){this.text.context.font=this.text.cssFont;var i=this.text.context.measureText(g.slice(0,h)).width;if(i>=b.x&&f>=b.y)return c>0?c-1:c}if(f>=b.y)return c;c++}else for(var h=0;h<this.value.length;h++,c++){this.text.context.font=this.text.cssFont;var i=this.text.context.measureText(this.value.slice(0,h)).width;if(i>=b.x)return c>0?c-1:c}return c},c.prototype.updateSelection=function(){if(this.domElement.hasSelection){var b=this.value;if(this.inputOptions.type===a.InputType.password){b="";for(var c=0;c<this.value.length;c++)b+="*"}switch(this.selection.updateSelection(this.domElement.caretStart,this.domElement.caretEnd,this.lines),this.inputOptions.align){case"left":this.selection.x=this.inputOptions.padding-this.scrollPos.x;break;case"center":this.selection.x=this.inputOptions.padding+this.inputOptions.width/2-this.text.width/2-this.scrollPos.x}this.selection.y=-this.scrollPos.y}else this.selection.clear()},c.prototype.zoomIn=function(){if(!a.Plugins.InputField.Zoomed){var b=this.getBounds();window.innerHeight>window.innerWidth?this.windowScale=this.game.width/(1.5*b.width):this.windowScale=this.game.width/2/(1.5*b.width);var c=(this.game.width-1.5*b.width)/2/this.windowScale;this.game.world.scale.set(this.game.world.scale.x*this.windowScale,this.game.world.scale.y*this.windowScale),this.game.world.pivot.set(b.x-c,b.y-2*this.inputOptions.padding),a.Plugins.InputField.Zoomed=!0}},c.prototype.zoomOut=function(){a.Plugins.InputField.Zoomed&&(this.game.world.scale.set(this.game.world.scale.x/this.windowScale,this.game.world.scale.y/this.windowScale),this.game.world.pivot.set(0,0),a.Plugins.InputField.Zoomed=!1)},c.prototype.inputListener=function(a){},c.prototype.keyDownListener=function(a){if(13===a.keyCode&&this.inputOptions.focusOutOnEnter)return void this.endFocus()},c.prototype.keyUpListener=function(a){},c.prototype.destroy=function(){this.domElement.destroy(),b.prototype.destroy.call(this)},c.prototype.resetText=function(){this.value=""},c.prototype.scrollTo=function(a){a.x<this.scrollPos.x?this.scrollPos.x+=a.x-this.scrollPos.x:a.x>this.scrollPos.x+this.inputOptions.width&&(this.scrollPos.x+=a.x-this.scrollPos.x-this.inputOptions.width),a.y<this.scrollPos.y?this.scrollPos.y+=a.y-this.scrollPos.y:a.y>this.scrollPos.y+this.inputOptions.height-this.cursor.height&&(this.scrollPos.y+=a.y+this.cursor.height-this.scrollPos.y-this.inputOptions.height),this.updateTextPos(),this.updateCursorPos()},c.prototype.updateTextPos=function(){switch(this.inputOptions.align){case"left":this.text.anchor.set(0,0),this.text.x=-this.scrollPos.x;break;case"center":this.text.anchor.set(.5,0),this.text.x=this.inputOptions.width/2-this.scrollPos.x;break;case"right":this.text.anchor.set(1,0),this.text.x=this.inputOptions.width-this.scrollPos.x}this.text.y=-this.scrollPos.y},c.prototype.updateCursorPos=function(){switch(this.inputOptions.align){case"left":this.cursor.x=this.inputOptions.padding+this.cursorPos.x-this.scrollPos.x;break;case"center":this.cursor.x=this.inputOptions.padding+this.inputOptions.width/2-this.text.width/2+this.cursorPos.x-this.scrollPos.x;break;case"right":this.cursor.x=this.inputOptions.padding+this.inputOptions.width-this.scrollPos.x}this.cursor.y=this.cursorPos.y-this.scrollPos.y},c}(Phaser.Sprite);a.InputField=b}(Fabrique||(Fabrique={}));var Fabrique;!function(a){var b=function(a){function b(b,c){a.call(this,b,0,0);var d=c.backgroundColor?parseInt(c.backgroundColor.slice(1),16):16777215,e=c.borderRadius||0,f=c.borderColor?parseInt(c.borderColor.slice(1),16):9803157,g=c.fillAlpha,h=c.height;c.font&&(h=Math.max(parseInt(c.font.substr(0,c.font.indexOf("px")),10),h)),h=2*c.padding+h;var i=c.width;i=2*c.padding+i,this.beginFill(d,g).lineStyle(c.borderWidth||1,f,g),e>0?this.drawRoundedRect(0,0,i,h,e):this.drawRect(0,0,i,h)}return __extends(b,a),b}(Phaser.Graphics);a.InputBox=b}(Fabrique||(Fabrique={}));var Fabrique;!function(a){var b=function(a){function b(b,c,d,e){a.call(this,b,c.padding,c.padding),this.inputOptions=c,this.text=d,this.cursor=e}return __extends(b,a),b.prototype.updateSelection=function(a,c,d){if(a>c){var e=a;a=c,c=e}var f=Phaser.Color.webToColor(this.inputOptions.selectionColor);this.clear();for(var g=0,h=0;h<d.length;h++){var i=d[h];if(g>=c)return;if(g+i.length>=a&&g<=c){var j=a>g?a-g:0,k=g+i.length<=c?i.length:c-g;this.text.context.font=this.text.cssFont;var l=this.text.context.measureText(i.slice(0,j)),m=this.text.context.measureText(i.slice(0,k));this.beginFill(b.rgb2hex(f),f.a),this.drawRect(l.width,h*this.cursor.height,m.width-l.width,this.cursor.height),this.endFill()}g+=i.length+1}},b.rgb2hex=function(a){return parseInt(("0"+a.r.toString(16)).slice(-2)+("0"+a.g.toString(16)).slice(-2)+("0"+a.b.toString(16)).slice(-2),16)},b}(Phaser.Graphics);a.SelectionHighlight=b}(Fabrique||(Fabrique={}));var Fabrique;!function(a){var b=function(a){function b(b,c){a.call(this,b,c.padding,c.padding);var d=c.borderRadius,e=c.height;c.font&&(e=Math.max(parseInt(c.font.substr(0,c.font.indexOf("px")),10),e));var f=c.width;this.beginFill(0),d>0?this.drawRoundedRect(0,0,f,e,d):this.drawRect(0,0,f,e)}return __extends(b,a),b}(Phaser.Graphics);a.TextMask=b}(Fabrique||(Fabrique={}));var Fabrique;!function(a){var b;!function(b){var c=function(b){function c(a,c){b.call(this,a,c),this.addInputFieldFactory()}return __extends(c,b),c.prototype.addInputFieldFactory=function(){Phaser.GameObjectFactory.prototype.inputField=function(b,c,d,e){void 0===e&&(e=this.world);var f=new a.InputField(this.game,b,c,d);return e.add(f)},Phaser.GameObjectCreator.prototype.inputField=function(b,c,d){return new a.InputField(this.game,b,c,d)}},c.Zoomed=!1,c.KeyboardOpen=!1,c.onKeyboardOpen=new Phaser.Signal,c.onKeyboardClose=new Phaser.Signal,c}(Phaser.Plugin);b.InputField=c}(b=a.Plugins||(a.Plugins={}))}(Fabrique||(Fabrique={}));